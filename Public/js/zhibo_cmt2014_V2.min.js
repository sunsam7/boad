/*! http://js.3conline.com/wap/pcauto/2014/touch/zhibo_cmt2014.js */
(function(U){var z=location.href,i=CONSTANT.voteUrl||"http://cmt.pcauto.com.cn/action/comment/support.jsp",v="m_CMT4_IP_AREA",B=CONSTANT.cmtListUrl||"http://cmt.pcauto.com.cn/templates/pcauto/getPartList.jsp?url="+escape(CONSTANT.wwwURL)+"&pageSize=6&order=0&partId=",H=CONSTANT.cmtPostUrl||"http://m.pcauto.com.cn/x/cmt/create.jsp",J=CONSTANT.cmtCountUrl||"http://cmt.pcauto.com.cn/action/topic/get_data.jsp?url="+escape(CONSTANT.wwwURL),d,N=0,I="",j="太平洋手机网友",R,P,b='<img title="[嘻嘻]" src="http://www.pconline.com.cn/images/comment/face201.gif"><img title="[酷]" src="http://www.pconline.com.cn/images/comment/face202.gif"><img title="[汗]" src="http://www.pconline.com.cn/images/comment/face203.gif"><img title="[鄙视]" src="http://www.pconline.com.cn/images/comment/face204.gif"><img title="[阴险]" src="http://www.pconline.com.cn/images/comment/face205.gif"><img title="[强]" src="http://www.pconline.com.cn/images/comment/face206.gif"><img title="[弱]" src="http://www.pconline.com.cn/images/comment/face207.gif"><img title="[花]" src="http://www.pconline.com.cn/images/comment/face208.gif"><img title="[便便]" src="http://www.pconline.com.cn/images/comment/face209.gif"><img title="[亲]" src="http://www.pconline.com.cn/images/comment/face210.gif">',aa=navigator.userAgent.toLowerCase(),E=/micromessenger/i.test(aa),ab="",O="";CONSTANT.broadcastId=CONSTANT.wwwURL.split("broadcastId=")[1];var F={get:function(X,am){var an=new XMLHttpRequest();an.open("GET",X,true);an.onreadystatechange=function(){if(an.readyState==4&&an.status==200||an.status==304){am.call(this,an.responseText);}};an.send(null);},post:function(X,an,am){var ao=new XMLHttpRequest();ao.open("POST",X,true);ao.setRequestHeader("Content-type","application/x-www-form-urlencoded");ao.onreadystatechange=function(){if(ao.readyState==4&&(ao.status==200||ao.status==304)){am.call(this,ao.responseText);}};ao.send(an);}};var c={get:function(an){an=encodeURIComponent(an);var at=document.cookie.split(";");var ao="";var aq="";var ar="";var ap=false;var am="";var X=at.length;for(am=0;am<X;am++){ao=at[am].split("=");aq=ao[0].replace(/^\s+|\s+$/g,"");if(aq==an){ap=true;if(ao.length>1){ar=decodeURIComponent(ao[1].replace(/^\s+|\s+$/g,""));}return ar;break;}ao=null;aq="";}if(!ap){return null;}},set:function(an,ap,X,at,ao,ar){var am=new Date();am.setTime(am.getTime());if(X){X=X*1000*60*60*24;}var aq=new Date(am.getTime()+(X));document.cookie=encodeURIComponent(an)+"="+encodeURIComponent(ap)+((X)?";expires="+aq.toGMTString():"")+((at)?";path="+at:"")+((ao)?";domain="+ao:"")+((ar)?";secure":"");}};function u(am,X,ao,an){am.addEventListener(ao,function(ap){if(ac(ap.target,X)){if(an){an.call(ap.target,ap);}}});}function ac(am,X){if(X.charAt(0)==="#"){return am.id===X.slice(1);}if(X.charAt(0)==="."){return(" "+am.className+" ").indexOf(" "+X.slice(1)+" ")!=-1;}return am.tagName.toLowerCase()===X.toLowerCase();}function w(ao,am){var X,an=ao.parentNode;while(an){if(ac(an,am)){X=an;break;}an=an.parentNode;}return X;}function h(an){var X=[],am;for(am in an){if(an.hasOwnProperty(am)){X.push(""+am+"="+an[am]);}}return X.join("&");}function q(){document.getElementById("captchax").src="http://captcha.pcauto.com.cn/captcha/v.jpg?"+new Date().getTime();}function r(X){var an=document.getElementById("cmtCheck"),am=document.getElementById("cmtCheck_pop");if(X){N=1;an.style.display="block";am.style.display="block";q();}else{N=0;an.style.display="none";am.style.display="none";}}function l(X){var am="";if(X.pro==X.city){am=X.city;}else{am=X.pro+X.city;}if(!am){am="";}am=am;c.set(v,am,1,"/","m.pcauto.com.cn","");c.set("mcoov","2",90,"/","m.pcauto.com.cn","");return am;}function ah(X){var am=w(X,".comment");if(am){am.className=am.className=="comment face-open"?"comment":"comment face-open";}}function T(ao){var ap=w(ao,".c-wrap");if(!ap){return;}var am=document.getElementById("comment_pop"),aq=ap.getAttribute("data-meta"),X="",an="";if(aq){X=aq.split(",");an="回复"+X[0]+"楼("+X[1]+")：";}else{an="输入回复内容";}if(am.parentNode==ap){if(ao.innerHTML=="回复"){ao.innerHTML="收起";am.style.display="block";document.getElementById("content_pop").placeholder=an;}else{ao.innerHTML="回复";am.style.display="none";}}else{if(P){P.querySelector(".repost").innerHTML="回复";}ao.innerHTML="收起";P=ap;ap.appendChild(am);am.style.display="block";document.getElementById("content_pop").placeholder=an;}}function G(am){var an=w(am,".c-wrap");if(!an){return;}var X=document.getElementById("comment");metaData="";holderhtml="输入回复内容";if(X.parentNode!=an){R=an;an.appendChild(X);X.style.display="block";document.getElementById("content").placeholder=holderhtml;}}function D(am,X){document.body.insertBefore(document.createElement("script"),document.body.firstChild).src=i+"?cid="+am+"&sp="+X+"&r="+Math.random();}function M(am){var ax=document.getElementById(am);if(!ax){return;}var aw=18;var aq=document.getElementById("Jplus1");if(!aq){aq=document.createElement("div");aq.id="Jplus1";aq.style.cssText="/*display:none;*/ position:absolute; width:"+aw+"px; line-height:20px; color:#F00; font-weight:bold; opacity:0;";aq.innerHTML="+1";document.body.appendChild(aq);}var X=aq.style;X.webkitTransition="";var an=ax.parentNode,au=an.getBoundingClientRect(),av=an.offsetWidth;var ar=document.body.scrollTop,ap=document.body.scrollLeft;var ao=ap+au.left+av/2-aw/2,at=ar+au.top-20;X.display="block";X.left=ao+"px";X.top=at+"px";X.opacity=1;setTimeout(function(){X.webkitTransition="all 0.3s ease-in";X.opacity=0;X.top=at-20+"px";setTimeout(function(){X.display="none";},300);},100);}function n(am){var an=am.isPop?"content_pop":"content",X=document.getElementById(an);if(am.content==""){X.focus();X.placeholder="请先输入您的评论！";return false;}if(am.content.length>500){X.focus();alert("评论内容字数不能超过500！");return false;}if(am.needCaptcha&&!captcha){document.getElementById("captcha"+(am.isPop?"_pop":"")).focus();return false;}return true;}function W(ao,an){ao=ao||"";var X={isEncode:1,windowname:0,url:escape(CONSTANT.wwwURL),title:CONSTANT.artTitle||document.title,id:O||"",columnId:"",username:al(),needCaptcha:N,area:d,client:E?7:6,partId:ab||"",broadcastId:CONSTANT.broadcastId||""};if(an&&Object.prototype.toString.call(an)=="[object Object]"){for(var am in an){if(an.hasOwnProperty(am)){X[am]=an[am];}}}X.content=ak(document.getElementById("content"+ao).value.trim());X.captcha=document.getElementById("captcha"+ao).value.trim();return X;}function ak(ap){var an=["{201}","{202}","{203}","{204}","{205}","{206}","{207}","{208}","{209}","{210}"];var X=["[嘻嘻]","[酷]","[汗]","[鄙视]","[阴险]","[强]","[弱]","[花]","[便便]","[亲]"];var ao;for(var am=an.length-1;am>=0;am--){ao=new RegExp(X[am].replace("[","\\[").replace("]","\\]"),"gm");ap=ap.replace(ao,an[am]);}return ap;}function s(an){var X=["title","username","area","content","broadcastId"];for(var am in an){if(X.indexOf(am)!==-1){an[am]=encodeURI(encodeURI(an[am]));}}return an;}function C(am){var an=am.isPop,ao=an?"_pop":"";if(!n(am)){document.getElementById("cmtSubmit"+ao).removeAttribute("disabled");return;}ai("正在发送");delete am.isPop;am=s(am);var X=h(am);F.post(H,X,function(ap){L(ap,{isPop:an});});}function L(an,X){var ap=X.isPop?"_pop":"";try{var am=JSON.parse(an);}catch(ao){o();document.getElementById("cmtSubmit"+ap).removeAttribute("disabled");alert("很抱歉，提交数据发生异常");return;}if(am.resultCode>=0){g(am);aj();if(X.isPop){document.getElementById("comment_pop").style.display="none";if(P){P.querySelector(".repost").innerHTML="回复";}}ai("发送成功");}if(am.resultCode==-9){r(true);}else{if(am.commentCount>5){r(true);}else{r(false);}}if(am.resultCode<0){alert(am.resultMsg);}o();document.getElementById("cmtSubmit"+ap).removeAttribute("disabled");}function ai(aq){var ao=document.getElementById("topTipMsg");var am=document.body.clientWidth;var X=Math.min(am,600);var ap=(am-X)/2;var an="22px";if(!ao){ao=document.createElement("div");ao.id="topTipMsg";ao.style.cssText="position:fixed; top:-"+an+"; width:"+X+"px; height:22px; line-height:22px; font-size:14px; background:rgba(48,48,48,0.7); color:#ccc; line-height:1.5; text-align:center; -webkit-transition:top 0.3s ease-in; -webkit-border-radius:0 0 5px 5px;-moz-border-radius:0 0 5px 5px;border-radius:0 0 5px 5px;z-index:1000;";document.body.appendChild(ao);}ao.innerHTML=aq;ao.style.display="block";ao.style.left=ap+"px";setTimeout(function(){ao.style.top="0";},0);}function o(){var X=document.getElementById("topTipMsg");if(X){setTimeout(function(){X.style.top="-22px";setTimeout(function(){X.style.display="none";},300);},1500);}}function g(ar){var aq=document.createElement("div");aq.className="c-wrap";var an=document.getElementById("comment"),am=w(an,"li"),ap=am.querySelector(".c-list");var X=E?"wechat":"mobile";if(ap.children.length==0){ap.appendChild(aq);}else{ap.insertBefore(aq,ap.firstElementChild);}var ao='<div class="c-th"><span class="user '+X+'">'+ar.showName+'</span><span class="count">'+ar.floor+'楼</span></div><div class="c-tb">'+t()+'<div class="c-body">'+ar.brief+'</div><p class="c-pmsg">(感谢参与评论,您的评论内容将在审核后公开。)</p></div>';aq.innerHTML=ao;}function t(){if(!replyObj.floor){return"";}var X='<div class="c-repeat">';if(replyObj.quoteContent){X+='<div class="c-repeat">'+replyObj.quoteContent+"</div>";}X+='<div class="c-inner"><div class="c-th"><span class="user">'+replyObj.uname+'</span><span class="count">'+replyObj.floor+'</span></div><div class="c-body">'+replyObj.content+"</div></div>";X+="</div>";return X;}function af(X){if(!X){return"";}var am='<div class="c-repeat">';am+='<div class="c-inner"><div class="c-th"><span class="user">'+X.nickName+'</span><span class="count">'+X.floor+'楼</span></div><div class="c-body">'+X.content+"</div></div>";am+="</div>";return am;}function p(ao,av,at){if(!av){return;}var ar=av.querySelector(".c-list"),ao=JSON.parse(ao),am=ao.response_info.pageCount,ao=ao.response_info.commentList,ap="",aq="",X=ao.length>5?5:ao.length;if(ao.length>5){aq='<div class="moreline morelineA"><a href="http://m.pcauto.com.cn/x/cmt_live_p/'+O+"_1_30_"+at+'.html">查看更多评论</a></div>';}for(var an=0;an<X;an++){var av=document.createElement("div");av.className="c-wrap";av.setAttribute("data-meta",ao[an].floor+","+ao[an].nickName);if(ar.children.length==0){ar.appendChild(av);}else{ar.appendChild(av,ar.firstElementChild);}var au="";switch(ao[an].client){case 4:au="weibo";break;case 5:au="qq";break;case 6:au="mobile";break;case 7:au="wechat";break;}ap='<div class="c-th"><span class="user '+au+'">'+ao[an].nickName+'</span><span class="count">'+ao[an].floor+'楼</span></div><div class="c-tb">'+af(ao[an].replyRef)+'<div class="c-body">'+ao[an].content+'</div></div><div class="c-ctrl"><span class="date">'+ao[an].createTime+'</span><span class="btn"><a href="javascript:cmt4_vote('+ao[an].id+',1)"><i id="support'+ao[an].id+'">'+ao[an].support+'</i></a><a href="javascript:void(0)" class="repost" >回复</a></span></div>';av.innerHTML=ap;}ar.innerHTML+=aq;}function aj(){document.getElementById("content").value="";document.getElementById("captcha").value="";document.getElementById("content_pop").value="";document.getElementById("captcha_pop").value="";}function f(ao){var at=S(ao,"li"),aq=at.querySelector(".c-list"),an=document.getElementById("comment"),ap=document.getElementById("Jcomment").querySelectorAll(".c-list");m=at.getAttribute("data-partid");for(var ar=0;ar<ap.length;ar++){ap[ar].style.display!=="none"&&aq!=ap[ar]&&(ap[ar].style.display="none");}A(ao);var am=S(ao,".c-wrap"),X=am.offsetTop;ao.innerHTML*1!==0&&aq.innerHTML==""?(V(m,at),aq.style.display="block",e.scrollTo(0,X-50)):aq.style.display!=="none"?(aq.style.display="none",an.style.display="none"):(aq.style.display="block",an.style.display="block",e.scrollTo(0,X-50));}function a(ar){var X=w(ar,"li"),aq=X.querySelector(".c-list"),at=document.getElementById("comment"),an=document.getElementById("Jcomment").querySelectorAll(".c-list");ab=X.getAttribute("data-partid");for(var ap=0;ap<an.length;ap++){if(an[ap].style.display!=="none"&&aq!=an[ap]){an[ap].style.display="none";}}G(ar);var am=w(ar,".c-wrap");var ao=am.offsetTop;console.log(ar.innerHTML);if(ar.innerHTML!="评论"&&aq.innerHTML==""&&aq.style.display=="none"){Q(ab,X);at.style.display="block";aq.style.display="block";U.scrollTo(0,ao-50);}else{if(aq.style.display!=="none"){aq.style.display="none";at.style.display="none";}else{aq.style.display="block";at.style.display="block";U.scrollTo(0,ao-50);}}}function Q(an,am){var X=B+an;F.get(X,function(ao){p(ao,am,an);});}function Y(am){var X=document.createElement("script");X.src=J+"&callback=parseCmtCount";if(am){X.onload=am;}document.getElementsByTagName("head")[0].appendChild(X);}function y(an){if(an.error){return;}O=an.id;var am=document.getElementById("cmtCount"),ao=document.getElementById("cmtCountA"),X=document.getElementById("comment-btn"),ap="http://m.pcauto.com.cn/x/cmt_live/"+an.id+"_1_30_"+CONSTANT.broadcastId+".html";if(am){am.innerHTML="网友评论<em>("+an.total+")</em> >> ";am.href=ap;}if(ao){ao.innerHTML="网友评论<em>("+an.total+")</em>";ao.href=ap;}if(X){X.href=ap;}}function ag(){c.set("cmu","",-1,"/",".pcauto.com.cn");c.set("common_session_id","",-1,"/",".pcauto.com.cn");c.set("logedUserId","",-1,"/",".pcauto.com.cn");c.set("logedUserName","",-1,"/",".pcauto.com.cn");var X=document.querySelectorAll(".comment .c-user");for(var am=X.length-1;am>=0;am--){X[am].innerHTML='<a href="http://m.pcauto.com.cn/my/passport/login.jsp?return='+U.location.href+'">登录</a>';}if(document.getElementById("JuserInfo")){document.getElementById("JuserInfo").innerHTML="";}}function k(){if(c.get("common_session_id")&&c.get("cmu")){c.set("userBackUrl",U.location.href,30,"/","pcauto.com.cn");U.location.href="http://m.pcauto.com.cn/my/";}}function ad(an){I=an.nickName;var ao=an.id||"";var X=document.querySelectorAll(".comment .c-user");for(var am=X.length-1;am>=0;am--){X[am].innerHTML='欢迎你， <a class="c-user-name" onclick="userInfo();">'+an.nickName+'</a> | <a href="javascript:;" onclick="signOut();">退出</a>';}}function Z(){I=c.get("logedUserName");var X=document.querySelectorAll(".comment .c-user");for(var am=X.length-1;am>=0;am--){X[am].innerHTML='欢迎你， <a class="c-user-name" onclick="userInfo();">'+I+'</a> | <a href="javascript:;" onclick="signOut();">退出</a>';}}function al(){var X;if(c.get("common_session_id")&&c.get("cmu")){X=I;}else{X=d?d+"网友":j;}return X;}function ae(){var X=document.querySelectorAll(".comment .c-user a"),ao=X.length,an=U.location.href;for(var am=0;am<ao;am++){X[am].href="http://m.pcauto.com.cn/my/passport/login.jsp?return="+an;}}function x(){var ao=document.getElementById("J-main");var X=document.querySelectorAll(".comment .c-face-btn");for(var an=X.length-1;an>=0;an--){(function(aq){var ap=X[aq];ap.addEventListener("click",function(at){var ar=ap.parentNode,au=ar.querySelector(".c-face-list");if(au.children.length==0){au.innerHTML=b;}ah(ap,".comment");});})(an);}var am=Array.prototype.slice.call(document.querySelectorAll(".comment .c-face-list"));am.forEach(function(ap){var aq=ap.getElementsByTagName("img");u(ap,"img","click",function(){var au=this;au.className="hlight";setTimeout(function(){au.className="";},300);var at=w(this,".comment");if(at){var ar=at.querySelector("textarea");if(ar){ar.value+=this.title;}}});});document.getElementById("cmtSubmit").addEventListener("click",function(ap){if(this.getAttribute("disabled")=="1"){return;}this.setAttribute("disabled","1");replyObj={};C(W());});document.getElementById("cmtSubmit_pop").addEventListener("click",function(av){if(this.getAttribute("disabled")=="1"){return;}this.setAttribute("disabled","1");replyObj={};var at=w(this,".c-wrap"),ar,au,aq;if(at){aq=at.getAttribute("data-meta").split(",");ar=at.querySelector(".c-tb > .c-body");au=at.querySelector(".c-tb .c-repeat");replyObj.content=ar.innerHTML;if(au){replyObj.quoteContent=au.innerHTML;}replyObj.floor=aq[0];replyObj.uname=aq[1];}var ap={isPop:1,replyFloor2:replyObj.floor||0};C(W("_pop",ap));});u(ao,".repost","click",function(ap){T(this);});u(ao,".repost_pop","click",function(ap){a(this);});}function K(){var am=document.getElementById("Jfont");if(am){var X=am.querySelector("em");var an=document.querySelector(".artBody");am.addEventListener("click",function(){an.style.fontSize=an.style.fontSize=="18px"?"16px":"18px";X.innerHTML=X.innerHTML=="-"?"+":"-";});}var ao=document.getElementById("btnTop");if(ao){ao.addEventListener("click",function(){U.scrollTo(0,0);},false);}ae();}U.Util={Ajax:F,Cookie:c,getCaptcha:q,setArea:l,signOut:ag,updateUser:ad,showTopTip:ai};U.Cookie=c;U.Ajax=F;U.cmt4_vote=D;U.cmt4_vote_success=M;U.parseCmtCount=y;U.closest=w;U.signOut=ag;U.loginUserInfo=Z;U.userInfo=k;U.scrollTo(0,0);K();if(!document.getElementById("Jcomment")){return;}x();if(c.get("mcoov")!=="2"){c.set("mcoov","2",90,"/","m.pcauto.com.cn","");c.set(v,"",-1,"/","m.pcauto.com.cn");}if(c.get("common_session_id")&&c.get("cmu")){ad({nickName:c.get("cmu")});if(!c.get("logedUserId")&&!c.get("logedUserName")){setTimeout(function(){var X=document.createElement("script");X.src="http://my.pcauto.com.cn/intf/getLogedUser.jsp?callback=Util.updateUser";document.getElementsByTagName("head")[0].appendChild(X);},10);}else{Z();}}Y();})(this);